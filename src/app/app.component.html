<header>
  <nav class="navbar">
    <div class="container">
      <div class="d-flex align-items-center">
        <a class="navbar-brand-image" href="#"><img src="../assets/images/dinit-icon-sm-white-rgb.png" alt="Dinit logo"></a>
        <a class="navbar-brand" href="#">HEALTHCHECK</a>
      </div>
      @if (this.authService.getCurrentUser() == null) {
        <button type="button" class="btn btn-sm btn-outline-light my-2 my-sm-0" data-bs-toggle="modal" data-bs-target="#login-form">Login</button>
      }
      @else {
        <div class="dropdown">
          <button class="btn btn-primary" type="button" id="dropdownMenu" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-list"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenu">
            @if (this.authService.getCurrentUser()?.role?.name === "ADMIN") {
              <li class="dropdown-header">
                <i class="bi bi-person-circle"></i> {{this.authService.getCurrentUser()?.firstName}} {{this.authService.getCurrentUser()?.lastName}} (A)
              </li>
            }
            @else {
              <li class="dropdown-header">
                <i class="bi bi-person-circle"></i> {{this.authService.getCurrentUser()?.firstName}} {{this.authService.getCurrentUser()?.lastName}}  (U)
              </li>
            }
            @if (this.authService.canUse2) {
              <li><hr class="dropdown-divider"></li>
              <li>
                <button class="dropdown-item" type="button" id="registerUserButton" data-bs-toggle="modal" data-bs-target="#register-form">Register user</button>
              </li>
              <li>
                <button class="dropdown-item" type="button" id="editUsersButton" data-bs-toggle="modal" data-bs-target="#editusers-form">Edit users</button>
              </li>
              <li><hr class="dropdown-divider"></li>
            }
            <li>
              <button class="dropdown-item" type="button" id="logoutButton" (click)="loggout()">
                Logout <i class="bi bi-box-arrow-right"></i>
              </button>
            </li>
          </ul>
        </div>
        
      }
    </div>
  </nav>
</header>

<main class="container mainBody">
  <section class="mb-4 mt-5">
    <div class="row">
      <div class="col-md-8">
        <div class="input-group search">
          <input type="text" class="form-control search-urls" [formControl]="searchControl" placeholder="Search by name or url">
          <i class="bi bi-search"></i>
        </div>
      </div>
      <div class="col-md-4 d-flex justify-content-end">
        <button class="btn btn-primary add-urls" type="button" data-bs-toggle="modal" data-bs-target="#add-form" [disabled]="!this.authService.canUse1" [hidden]="!this.authService.canUse1">Add url</button>
      </div>
    </div>
  </section>

  @if (urlinfos.length != 0) {
    <section>
      <div class="container mt-5">
        <table class="table table-striped table-hover table-bordered">
          <thead>
            <tr>
              <th>Display Name</th>
              <th>Full URL</th>
              <th>
                <div class="d-flex align-items-center">
                  <button class="btn btn-sm ml-2" (click)="changeOrder()">Status</button>
                </div>
              </th>
              <th>Check Frequency</th>
              <th>Mute</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (urlinfo of this.urlinfos; track urlinfo.id) {
              <tr>
                <td>{{urlinfo.displayName}}</td>
                <td>{{urlinfo.url}}</td>
                @if (urlinfo?.healthy) {
                  <td><span class="status-circle healthy shad"></span></td>
                }
                @else {
                  <td><span class="status-circle unhealthy shad"></span></td>
                }
                <td>{{urlinfo.frequency}} min</td>
                @if (urlinfo.mute) {
                  <td><button class="btn btn-warning btn-sm" [disabled]="!this.authService.canUse1" (click)="toggle(urlinfo.id)">Unmute</button></td>
                }
                @else {
                  <td><button class="btn btn-warning btn-sm" [disabled]="!this.authService.canUse1" (click)="toggle(urlinfo.id)">Mute</button></td>
                }
                <td>
                  <button class="btn btn-primary tooltips" data-placement="top" data-original-title="Edit" data-bs-toggle="modal" [disabled]="!this.authService.canUse1" data-bs-target="#editModal" (click)="openEditModal(urlinfo.displayName, urlinfo.url, urlinfo.id, urlinfo.frequency)"><i class="fa fa-pencil"></i></button>
                  <button class="btn btn-secondary tooltips" data-placement="top" data-original-title="Emails" data-bs-toggle="modal" [disabled]="!this.authService.canUse1" data-bs-target="#editEmailsModal" (click)="openModal(urlinfo.id)"><i class="bi bi-envelope"></i></button>
                  <button class="btn btn-secondary del tooltips" data-placement="top" data-original-title="Delete" data-bs-toggle="modal" [disabled]="!this.authService.canUse1" data-bs-target="#deleteModal" (click)="openModal(urlinfo.id)"><i class="fa fa-times"></i></button>
                  <button class="btn btn-primary tooltips" data-placement="top" data-original-title="PerformNow" [disabled]="!this.authService.canUse1" (click)="performHealthCheckNow(urlinfo.id)">Now</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </section>
  }
</main>

@if (urlinfos.length == 0) {
  <div class="col-lg-12 col-md-12 col-xl-12 p-4">
    <div class="alert alert-info" role="alert">
      <h4 class="alert-heading">NO SAVERD URLS!</h4>
      <p>No urls were found.</p>
    </div>
  </div>
}

<app-login></app-login>
<app-add></app-add>
<app-delete [inputFromParent]="idToDelete"></app-delete>
<app-edit [urlInfo]="urlInfoToUpdate" [inputFromParent]="idToUpdate"></app-edit>
<app-emails [inputFromParent]="idToDelete"></app-emails>
<app-register></app-register>
<app-editusers></app-editusers>
