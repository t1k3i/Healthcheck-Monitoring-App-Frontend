<header>
  <nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container">
      <div>
        <a class="navbar-brand" href="#">Healthcheck app</a>
        <div class="dropdown">
          <button type="button" class="btn btn-light me-2 dropbtn" [disabled]="!this.authService.canUse2"><i class="bi bi-gear"></i></button>
          @if (this.authService.canUse2) {
            <div class="dropdown-content">
              <button type="button" data-bs-toggle="modal" data-bs-target="#register-form">Register user</button>
              <button data-bs-toggle="modal" data-bs-target="#editusers-form">Edit users</button>
            </div>
          }
        </div>
      </div>
      @if (this.authService.getCurrentUser() == null) {
        <button type="button" class="btn btn-outline-light my-2 my-sm-0" data-bs-toggle="modal" data-bs-target="#login-form">Login</button>
      }
      @else {
        <div>
          <span class="me-3 userCred">{{this.authService.getCurrentUser()?.firstName}} {{this.authService.getCurrentUser()?.lastName}}</span>
          <button type="button" class="btn btn-outline-light my-2 my-sm-0" (click)="loggout()">Logout</button>
        </div>
      }
    </div>
  </nav>
</header>

<main class="container mainBody">
  <section class="mb-4">
    <div class="row">
      <div class="col-md-8">
        <div class="input-group">
          <input type="text" class="form-control search-urls" [formControl]="searchControl" placeholder="Search...">
        </div>
      </div>
      <div class="col-md-4 d-flex justify-content-end">
        <button class="btn btn-primary add-urls" type="button" data-bs-toggle="modal" data-bs-target="#add-form" [disabled]="!this.authService.canUse1">Add Url</button>
      </div>
    </div>
  </section>

  @if (urlinfos.length != 0) {
    <section>
      <div class="container mt-5">
        <table class="table table-striped table-hover table-bordered">
          <thead>
            <tr>
              <th>Display Name</th>
              <th>Full URL</th>
              <th>
                <div class="d-flex align-items-center">
                  <button class="btn btn-sm ml-2" (click)="changeOrder()">Status</button>
                </div>
              </th>
              <th>Check Frequency</th>
              <th>Mute</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for (urlinfo of this.urlinfos; track urlinfo.id) {
              <tr>
                <td>{{urlinfo.displayName}}</td>
                <td>{{urlinfo.url}}</td>
                @if (urlinfo?.healthy) {
                  <td><span class="status-circle healthy shad"></span></td>
                }
                @else {
                  <td><span class="status-circle unhealthy shad"></span></td>
                }
                <td>{{urlinfo.frequency}} min</td>
                @if (urlinfo.mute) {
                  <td><button class="btn btn-warning btn-sm" [disabled]="!this.authService.canUse1" (click)="toggle(urlinfo.id)">Unmute</button></td>
                }
                @else {
                  <td><button class="btn btn-warning btn-sm" [disabled]="!this.authService.canUse1" (click)="toggle(urlinfo.id)">Mute</button></td>
                }
                <td>
                  <button class="btn btn-primary tooltips" data-placement="top" data-original-title="Edit" data-bs-toggle="modal" [disabled]="!this.authService.canUse1" data-bs-target="#editModal" (click)="openEditModal(urlinfo.displayName, urlinfo.url, urlinfo.id, urlinfo.frequency)"><i class="fa fa-pencil"></i></button>
                  <button class="btn btn-secondary tooltips" data-placement="top" data-original-title="Emails" data-bs-toggle="modal" [disabled]="!this.authService.canUse1" data-bs-target="#editEmailsModal" (click)="openModal(urlinfo.id)"><i class="bi bi-envelope"></i></button>
                  <button class="btn btn-secondary del tooltips" data-placement="top" data-original-title="Delete" data-bs-toggle="modal" [disabled]="!this.authService.canUse1" data-bs-target="#deleteModal" (click)="openModal(urlinfo.id)"><i class="fa fa-times"></i></button>
                  <button class="btn btn-primary tooltips" data-placement="top" data-original-title="PerformNow" [disabled]="!this.authService.canUse1" (click)="performHealthCheckNow(urlinfo.id)">Now</button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </section>
  }
</main>

@if (urlinfos.length == 0) {
  <div class="col-lg-12 col-md-12 col-xl-12 p-4">
    <div class="alert alert-info" role="alert">
      <h4 class="alert-heading">NO SAVERD URLS!</h4>
      <p>No urls were found.</p>
    </div>
  </div>
}

<app-login></app-login>
<app-add></app-add>
<app-delete [inputFromParent]="idToDelete"></app-delete>
<app-edit [urlInfo]="urlInfoToUpdate" [inputFromParent]="idToUpdate"></app-edit>
<app-emails [inputFromParent]="idToDelete"></app-emails>
<app-register></app-register>
<app-editusers></app-editusers>
